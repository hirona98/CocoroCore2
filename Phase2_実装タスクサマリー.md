# Phase 2: 実装タスクサマリー

## 📅 作成日: 2025-01-28
## 🎯 目的: Phase 2実装のタスク管理とマイルストーン

---

## 📋 実装タスク一覧

### 🟨 Step 1: MemCube取得ヘルパーメソッド実装 (優先度: 高)

#### Task 1.1: MemCube取得メソッド実装
- **ファイル**: `src/core_app.py`
- **内容**: `_get_user_memcube()`メソッドの実装
- **詳細**: 
  - ユーザーのデフォルトMemCubeを安全に取得
  - エラーハンドリングとログ出力
  - None返却の適切な処理
- **推定時間**: 60分
- **依存関係**: なし

#### Task 1.2: MemCube ID取得メソッド実装
- **ファイル**: `src/core_app.py`
- **内容**: `_get_user_memcube_id()`メソッドの実装
- **詳細**:
  - MemCube IDのみを取得する軽量メソッド
  - ログ用・デバッグ用途
- **推定時間**: 30分
- **依存関係**: Task 1.1

#### Task 1.3: 安全実行メソッド実装
- **ファイル**: `src/core_app.py`
- **内容**: `_safely_submit_to_scheduler()`メソッドの実装
- **詳細**:
  - スケジューラーへの安全なメッセージ送信
  - グレースフルデグラデーション対応
  - 統一されたエラーハンドリング
- **推定時間**: 45分
- **依存関係**: なし

#### Task 1.4: ヘルパーメソッドテスト作成
- **ファイル**: `tests/test_phase2_helpers.py` (新規)
- **内容**: ヘルパーメソッドの単体テスト
- **詳細**:
  - MemCube取得のテスト
  - エラーケースのテスト
  - モック使用のテスト
- **推定時間**: 90分
- **依存関係**: Task 1.1, 1.2, 1.3

### 🟨 Step 2: チャット処理スケジューラー連携 (優先度: 高)

#### Task 2.1: memos_chat()メソッド分析・準備
- **ファイル**: `src/core_app.py`
- **内容**: 既存メソッドの詳細分析とリファクタリング準備
- **詳細**:
  - 現在の処理フローの整理
  - 拡張ポイントの特定
  - 後方互換性の確保
- **推定時間**: 45分
- **依存関係**: なし

#### Task 2.2: クエリメッセージ送信機能実装
- **ファイル**: `src/core_app.py`
- **内容**: `memos_chat()`にクエリメッセージ送信を追加
- **詳細**:
  - QUERY_LABELでのメッセージ送信
  - 設定による機能制御
  - エラー時のフォールバック
- **推定時間**: 75分
- **依存関係**: Task 1.1, 1.3, 2.1

#### Task 2.3: 応答メッセージ送信機能実装
- **ファイル**: `src/core_app.py`
- **内容**: `memos_chat()`に応答メッセージ送信を追加
- **詳細**:
  - ANSWER_LABELでのメッセージ送信
  - 設定による機能制御
  - 既存機能への影響なし
- **推定時間**: 75分
- **依存関係**: Task 2.2

#### Task 2.4: チャット統合テスト作成
- **ファイル**: `tests/test_phase2_chat_integration.py` (新規)
- **内容**: チャット機能のスケジューラー連携テスト
- **詳細**:
  - スケジューラー有効時のテスト
  - スケジューラー無効時のテスト
  - エラーケースのテスト
- **推定時間**: 120分
- **依存関係**: Task 2.2, 2.3

### 🟨 Step 3: 記憶追加スケジューラー連携 (優先度: 高)

#### Task 3.1: add_memory()メソッド拡張
- **ファイル**: `src/core_app.py`
- **内容**: 記憶追加処理にスケジューラー連携を追加
- **詳細**:
  - ADD_LABELでのメッセージ送信
  - 元コンテンツの保持
  - 設定による機能制御
- **推定時間**: 60分
- **依存関係**: Task 1.1, 1.3

#### Task 3.2: 記憶統合テスト作成
- **ファイル**: `tests/test_phase2_memory_integration.py` (新規)
- **内容**: 記憶追加機能のスケジューラー連携テスト
- **詳細**:
  - 記憶追加メッセージ送信のテスト
  - 既存機能への影響確認
  - エラー時の動作確認
- **推定時間**: 75分
- **依存関係**: Task 3.1

### 🟨 Step 4: 設定拡張とステータス機能 (優先度: 中)

#### Task 4.1: config.py拡張
- **ファイル**: `src/config.py`
- **内容**: MemSchedulerConfigクラスの拡張
- **詳細**:
  - チャット連携設定の追加
  - エラーハンドリング設定の追加
  - バリデーション機能の拡張
- **推定時間**: 45分
- **依存関係**: なし

#### Task 4.2: default_memos_config.json更新
- **ファイル**: `config/default_memos_config.json`
- **内容**: デフォルト設定にPhase 2設定を追加
- **詳細**:
  - チャット連携設定のデフォルト値
  - エラーハンドリング設定のデフォルト値
- **推定時間**: 15分
- **依存関係**: Task 4.1

#### Task 4.3: get_app_status()拡張
- **ファイル**: `src/core_app.py`
- **内容**: アプリケーション状態にPhase 2情報を追加
- **詳細**:
  - スケジューラー連携状態の表示
  - MemCube利用可能性の表示
  - 設定状態の表示
- **推定時間**: 30分
- **依存関係**: Task 4.1

#### Task 4.4: 設定テスト更新
- **ファイル**: `tests/test_scheduler_config.py`
- **内容**: 既存設定テストにPhase 2設定を追加
- **詳細**:
  - 新設定項目のテスト
  - バリデーション機能のテスト
  - デフォルト値のテスト
- **推定時間**: 60分
- **依存関係**: Task 4.1, 4.2

### 🟩 Step 5: 統合テスト・検証 (優先度: 中)

#### Task 5.1: Phase 2統合テスト作成
- **ファイル**: `tests/test_phase2_integration.py` (新規)
- **内容**: Phase 2全体の統合テスト
- **詳細**:
  - エンドツーエンドのチャットフローテスト
  - スケジューラー連携の動作確認
  - 既存機能への影響確認
- **推定時間**: 120分
- **依存関係**: 全てのTask 1.x, 2.x, 3.x

#### Task 5.2: 実動作確認テスト
- **ファイル**: `tests/test_phase2_manual.py` (新規)
- **内容**: 手動実行による動作確認
- **詳細**:
  - 実際のチャット処理での動作確認
  - ログ出力の確認
  - スケジューラーメッセージの確認
- **推定時間**: 90分
- **依存関係**: Task 5.1

#### Task 5.3: パフォーマンステスト
- **内容**: スケジューラー連携による性能影響の測定
- **詳細**:
  - チャット応答速度の測定
  - メモリ使用量の測定
  - スケジューラー負荷の測定
- **推定時間**: 60分
- **依存関係**: Task 5.1

#### Task 5.4: ドキュメント更新
- **ファイル**: `README.md`, その他
- **内容**: Phase 2実装の反映
- **詳細**:
  - 新機能の説明追加
  - 設定方法の説明追加
  - トラブルシューティング追加
- **推定時間**: 45分
- **依存関係**: Task 5.2

---

## 🎯 マイルストーン

### Milestone 1: ヘルパーメソッド完成 (Step 1完了)
- **期限**: 実装開始から1日
- **成果物**: 
  - MemCube取得機能
  - 安全実行機能
  - 基本テスト

### Milestone 2: チャット連携完成 (Step 2完了)
- **期限**: 実装開始から3日
- **成果物**:
  - チャット処理のスケジューラー連携
  - クエリ・応答メッセージ自動送信
  - チャット統合テスト

### Milestone 3: 記憶連携完成 (Step 3完了)
- **期限**: 実装開始から4日
- **成果物**:
  - 記憶追加のスケジューラー連携
  - ADDメッセージ自動送信
  - 記憶統合テスト

### Milestone 4: 設定・ステータス完成 (Step 4完了)
- **期限**: 実装開始から5日
- **成果物**:
  - 拡張された設定機能
  - 詳細なステータス表示
  - 更新されたテスト

### Milestone 5: Phase 2完全完了 (Step 5完了)
- **期限**: 実装開始から6日
- **成果物**:
  - 完全なテストスイート
  - 動作確認済みアプリケーション
  - 更新されたドキュメント

---

## 📊 進捗トラッキング

### 全体進捗
- **総タスク数**: 18
- **完了タスク**: 0
- **進行中タスク**: 0
- **未着手タスク**: 18
- **進捗率**: 0%

### Step別進捗
- **Step 1 (ヘルパーメソッド)**: 0/4 (0%)
- **Step 2 (チャット連携)**: 0/4 (0%)
- **Step 3 (記憶連携)**: 0/2 (0%)
- **Step 4 (設定・ステータス)**: 0/4 (0%)
- **Step 5 (統合テスト)**: 0/4 (0%)

---

## 🔧 開発環境セットアップ

### 前提条件
- Phase 1の実装が完了していること
- MemOSライブラリがインストール済み
- CocoroCore2の実行環境が構築済み

### 推奨開発ツール
- IDE: VS Code + Python拡張
- テストツール: pytest
- リンター: ruff
- フォーマッター: ruff format

### 開発用コマンド
```bash
# 仮想環境アクティベート（WSL環境）
powershell.exe ".\.venv\Scripts\Activate"

# テスト実行
python -X utf8 -m pytest tests/test_phase2_*.py -v

# リンティング
ruff check src/

# フォーマット
ruff format src/
```

---

## 🚨 リスク・注意事項

### 技術的リスク
1. **MemCube取得の失敗**
   - ユーザーのMemCubeが存在しない場合
   - MOSへの登録が不完全な場合

2. **スケジューラー応答性**
   - メッセージ送信の遅延がチャット応答に影響
   - 並列処理による競合状態

3. **メモリ使用量増加**
   - スケジューラーの追加処理による負荷
   - MemCubeのメモリ使用量

### 実装時の注意点
1. **既存機能の保護**
   - チャット機能の基本動作を絶対に破綻させない
   - スケジューラーエラーで停止させない

2. **非同期処理の考慮**
   - スケジューラーメッセージ送信は非ブロッキング
   - 適切な同期処理の実装

3. **ログ重視**
   - デバッグのための詳細なログ出力
   - エラー追跡可能な情報記録

4. **段階的テスト**
   - 各ステップで動作確認を実施
   - 単体テスト → 統合テスト → 実動テストの順

---

## 📝 次のステップ (Phase 3以降)

### Phase 3予定項目
- テキストメモリ最適化機能の実装
- 重複検出・統合機能
- 関連性評価の改善
- ワーキングメモリの自動管理

### Phase 4予定項目
- 高度な記憶検索機能
- ユーザー行動パターン学習
- プロアクティブな記憶提案

---

*このタスクサマリーはPhase 2実装の進捗管理に使用します。タスク完了時に随時更新してください。*