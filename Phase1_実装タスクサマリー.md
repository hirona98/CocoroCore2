# Phase 1: 実装タスクサマリー

## 📅 作成日: 2025-01-28
## 🎯 目的: Phase 1実装のタスク管理とマイルストーン

---

## 📋 実装タスク一覧

### 🟨 Step 1: 設定拡張 (優先度: 高)

#### Task 1.1: config.py 修正
- **ファイル**: `src/config.py`
- **内容**: `MemSchedulerConfig`クラスの追加
- **詳細**: 
  - 新しい設定クラスを定義
  - `CocoroCore2Config`に`mem_scheduler`フィールドを追加
  - バリデーション機能を実装
- **推定時間**: 30分
- **依存関係**: なし

#### Task 1.2: default_memos_config.json 修正
- **ファイル**: `config/default_memos_config.json`
- **内容**: スケジューラー設定の追加
- **詳細**:
  - JSON形式でスケジューラー設定を追加
  - テキストメモリ特化の設定を含める
- **推定時間**: 15分
- **依存関係**: Task 1.1

#### Task 1.3: 設定読み込みテスト
- **ファイル**: `tests/test_scheduler_config.py` (新規)
- **内容**: 設定読み込みの検証
- **詳細**:
  - 設定ファイルの正常読み込みテスト
  - バリデーションエラーのテスト
- **推定時間**: 45分
- **依存関係**: Task 1.1, 1.2

### 🟨 Step 2: スケジューラー統合モジュール作成 (優先度: 高)

#### Task 2.1: scheduler_config.py 作成
- **ファイル**: `src/core/scheduler_config.py` (新規)
- **内容**: 設定変換・管理モジュール
- **詳細**:
  - `create_scheduler_config_factory()`実装
  - `validate_scheduler_config()`実装
  - エラーハンドリング実装
- **推定時間**: 60分
- **依存関係**: Task 1.1

#### Task 2.2: text_memory_scheduler.py 作成
- **ファイル**: `src/core/text_memory_scheduler.py` (新規)
- **内容**: スケジューラー統合管理クラス
- **詳細**:
  - `TextMemorySchedulerManager`クラス実装
  - 初期化・ライフサイクル管理
  - メッセージ送信機能
  - ステータス取得機能
- **推定時間**: 120分
- **依存関係**: Task 2.1

#### Task 2.3: スケジューラーモジュールテスト
- **ファイル**: `tests/test_text_memory_scheduler.py` (新規)
- **内容**: スケジューラーモジュールの単体テスト
- **詳細**:
  - 設定変換のテスト
  - スケジューラー管理のテスト
  - エラーケースのテスト
- **推定時間**: 90分
- **依存関係**: Task 2.1, 2.2

### 🟨 Step 3: CocoroCore2App統合 (優先度: 高)

#### Task 3.1: core_app.py 修正
- **ファイル**: `src/core_app.py`
- **内容**: スケジューラー統合
- **詳細**:
  - `__init__`メソッドにスケジューラー初期化追加
  - `startup()`メソッドにスケジューラー開始追加
  - `shutdown()`メソッドにスケジューラー停止追加
  - `_get_chat_llm_from_mos()`メソッド実装
- **推定時間**: 90分
- **依存関係**: Task 2.2

#### Task 3.2: MOSからLLM取得の実装
- **ファイル**: `src/core_app.py`
- **内容**: MOSからLLMインスタンス取得
- **詳細**:
  - MOSの内部構造を調査
  - LLMインスタンス取得ロジック実装
  - フォールバック処理実装
- **推定時間**: 60分
- **依存関係**: Task 3.1

#### Task 3.3: エラーハンドリング強化
- **ファイル**: `src/core_app.py`
- **内容**: スケジューラー関連のエラーハンドリング
- **詳細**:
  - スケジューラーエラーがアプリ全体を停止させない仕組み
  - 適切なログ出力
  - グレースフルデグラデーション
- **推定時間**: 45分
- **依存関係**: Task 3.1, 3.2

### 🟩 Step 4: テスト・検証 (優先度: 中)

#### Task 4.1: 統合テスト作成
- **ファイル**: `tests/test_phase1_integration.py` (新規)
- **内容**: Phase 1の統合テスト
- **詳細**:
  - アプリケーション起動・終了テスト
  - スケジューラー初期化テスト
  - 設定の統合テスト
- **推定時間**: 120分
- **依存関係**: 全てのTask 3.x

#### Task 4.2: 手動テスト・検証
- **内容**: 実際の動作確認
- **詳細**:
  - アプリケーション起動確認
  - ログ出力確認
  - エラーケース確認
  - 既存機能への影響確認
- **推定時間**: 60分
- **依存関係**: Task 4.1

#### Task 4.3: ドキュメント更新
- **ファイル**: `README.md`, その他
- **内容**: Phase 1実装の反映
- **詳細**:
  - 新機能の説明追加
  - 設定方法の説明追加
  - トラブルシューティング追加
- **推定時間**: 30分
- **依存関係**: Task 4.2

---

## 🎯 マイルストーン

### Milestone 1: 基本設定完了 (Step 1完了)
- **期限**: 実装開始から1日
- **成果物**: 
  - 修正された設定ファイル
  - 設定読み込み機能
  - 基本テスト

### Milestone 2: スケジューラーモジュール完成 (Step 2完了)
- **期限**: 実装開始から3日
- **成果物**:
  - スケジューラー統合モジュール
  - 設定変換機能
  - 単体テスト

### Milestone 3: アプリケーション統合完了 (Step 3完了)
- **期限**: 実装開始から5日
- **成果物**:
  - 統合されたCocoroCore2App
  - エラーハンドリング
  - ライフサイクル管理

### Milestone 4: Phase 1完全完了 (Step 4完了)
- **期限**: 実装開始から7日
- **成果物**:
  - 完全なテストスイート
  - 動作確認済みアプリケーション
  - 更新されたドキュメント

---

## 📊 進捗トラッキング

### 全体進捗
- **総タスク数**: 12
- **完了タスク**: 0
- **進行中タスク**: 0
- **未着手タスク**: 12
- **進捗率**: 0%

### Step別進捗
- **Step 1 (設定拡張)**: 0/3 (0%)
- **Step 2 (モジュール作成)**: 0/3 (0%)
- **Step 3 (アプリ統合)**: 0/3 (0%)
- **Step 4 (テスト・検証)**: 0/3 (0%)

---

## 🔧 開発環境セットアップ

### 前提条件
- Python 3.10以上
- MemOSライブラリがインストール済み
- CocoroCore2の実行環境が構築済み

### 推奨開発ツール
- IDE: VS Code + Python拡張
- テストツール: pytest
- リンター: ruff
- フォーマッター: black

### 開発用コマンド
```bash
# 仮想環境アクティベート
.\.venv\Scripts\Activate

# テスト実行
pytest tests/

# リンティング
ruff check src/

# フォーマット
ruff format src/
```

---

## 🚨 リスク・注意事項

### 技術的リスク
1. **MemOS内部構造への依存**
   - MOSからLLMインスタンス取得が内部実装に依存
   - MemOSのバージョンアップ時に影響を受ける可能性

2. **非同期処理の複雑性**
   - スケジューラーは別スレッドで動作
   - 適切な同期処理が必要

3. **エラー伝播**
   - スケジューラーエラーがアプリ全体に影響する可能性
   - グレースフルデグラデーションが重要

### 実装時の注意点
1. **既存機能への影響**
   - 既存のMOS機能を破壊しないよう注意
   - 段階的な統合を心がける

2. **設定の後方互換性**
   - 新しい設定項目はオプショナルに
   - デフォルト値を適切に設定

3. **ログとデバッグ**
   - 詳細なログ出力を実装
   - トラブルシューティングを考慮

---

## 📝 次のステップ (Phase 2以降)

### Phase 2予定項目
- チャット処理でのスケジューラー活用
- クエリ・応答メッセージの自動送信
- ワーキングメモリの自動更新

### Phase 3予定項目
- テキストメモリ最適化機能
- 重複検出・統合機能
- 関連性評価の改善

---

*このタスクサマリーはPhase 1実装の進捗管理に使用します。タスク完了時に随時更新してください。*